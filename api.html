<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Abyss03 Nexus — API Explorer</title>
  <link rel="stylesheet" href="theme-abyss03.css">
  <style>
    .tabs {display:flex;gap:12px;margin-bottom:16px;}
    .tabs button {padding:8px 16px;border:none;border-radius:6px;cursor:pointer;background:#222;color:#eee;}
    .tabs button.active {background:var(--accent);color:#fff;}
    .layout {display:grid;grid-template-columns:250px 1fr;gap:18px;}
    .navlist {background:#111;border:1px solid var(--divider);border-radius:6px;overflow:auto;max-height:80vh;padding:5px;}
    .navlist details {margin-bottom:8px;}
    .navlist summary {cursor:pointer;padding:6px 10px;background:#1a1a1a;color:#ccc;font-weight:bold;border-bottom:1px solid #222;}
    .navlist ul {list-style:none;margin:0;padding:0;}
    .navlist li {border-bottom:1px solid var(--divider);}
    .navlist li a {display:block;padding:6px 12px;color:#ccc;text-decoration:none;}
    .navlist li a:hover {background:#222;color:#fff;}
    .navlist li a.active {background:var(--accent);color:#fff;}
    .code-block {background:#111;padding:10px;border-radius:6px;overflow:auto;font-family:ui-monospace,monospace;font-size:14px;line-height:1.4;}
    .refresh-btn {margin-top:8px;padding:6px 10px;background:#333;color:#eee;border:1px solid #555;border-radius:4px;cursor:pointer;}
    .refresh-btn:hover {background:#444;}
    @media(max-width:900px){.layout{grid-template-columns:1fr}}
  </style>
</head>
<body class="backdrop">
<header>
  <div class="container">
    <nav class="topnav" role="navigation">
      <a href="index.html" class="brand">Abyss03 Nexus</a>
      <div class="links">
        <a href="index.html">Home</a>
        <a href="docs.html">Docs</a>
        <a href="captures.html">Captures</a>
        <a href="api.html" class="active">API</a>
        <a href="health.html">Health</a>
      </div>
    </nav>
    <div class="title">
      <div class="wordmark">ABYSS03 <span class="nexus">NEXUS</span></div>
      <div class="claimline">Dust 514 Server Core — API Explorer</div>
    </div>
  </div>
</header>

<main class="container">
  <div class="tabs">
    <button id="tab-explorer" class="active" onclick="switchTab('explorer')">Explorer</button>
    <button id="tab-create" onclick="switchTab('create')">Character Creation</button>
  </div>


  <div id="explorer" class="layout">
    <div class="navlist">
      <details open><summary>Server</summary>
        <ul><li><a href="#" data-endpoint="/dust/server/">GET /dust/server/</a></li></ul>
      </details>

      <details><summary>Login</summary>
        <ul><li><a href="#" data-endpoint="/dust/login/">GET /dust/login/</a></li></ul>
      </details>

      <details><summary>Messages</summary>
        <ul><li><a href="#" data-endpoint="/dust/motd/">GET /dust/motd/</a></li></ul>
      </details>

      <details><summary>Characters</summary>
        <ul>
          <li><a href="#" data-endpoint="/dust/characters/">GET /dust/characters/</a></li>
          <li><a href="#" data-endpoint="/dust/characters/{id}/">GET /dust/characters/{id}/</a></li>
        </ul>
      </details>

      <details><summary>Corporations</summary>
        <ul>
          <li><a href="#" data-endpoint="/dust/corporations/">GET /dust/corporations/</a></li>
          <li><a href="#" data-endpoint="/dust/corporations/{id}/">GET /dust/corporations/{id}/</a></li>
          <li><a href="#" data-endpoint="/dust/corporations/{id}/members/">GET /dust/corporations/{id}/members/</a></li>
          <li><a href="#" data-endpoint="/dust/corporations/{id}/applications/">GET /dust/corporations/{id}/applications/</a></li>
          <li><a href="#" data-endpoint="/dust/corporations/{id}/accounts/">GET /dust/corporations/{id}/accounts/</a></li>
        </ul>
      </details>

      <details><summary>Contracts</summary>
        <ul>
          <li><a href="#" data-endpoint="/dust/contracts/">GET /dust/contracts/</a></li>
          <li><a href="#" data-endpoint="/dust/contracts/{id}/">GET /dust/contracts/{id}/</a></li>
        </ul>
      </details>

      <details><summary>Future</summary>
        <ul>
          <li><a href="#" data-endpoint="/dust/fittings/">GET /dust/fittings/</a></li>
          <li><a href="#" data-endpoint="/dust/alliances/">GET /dust/alliances/</a></li>
          <li><a href="#" data-endpoint="/dust/stats/">GET /dust/stats/</a></li>
        </ul>
      </details>

      <details open><summary>CREST</summary>
        <ul>
          <li><a href="#" data-endpoint="/crest/">GET /crest/</a></li>
          <li><a href="#" data-endpoint="/crest/rawconfig/">GET /crest/rawconfig/</a></li>
          <li><a href="#" data-endpoint="/crest/user/bloodlines/">GET /crest/user/bloodlines/</a></li>
          <li><a href="#" data-endpoint="/crest/user/races/">GET /crest/user/races/</a></li>
          <li><a href="#" data-endpoint="/crest/user/specialties/">GET /crest/user/specialties/</a></li>
          <li><a href="#" data-endpoint="/crest/user/portraits/">GET /crest/user/portraits/</a></li>
          <li><a href="#" data-endpoint="/crest/battles/">GET /crest/battles/</a></li>
          <li><a href="#" data-endpoint="/crest/battles/{id}/">GET /crest/battles/{id}/</a></li>
          <li><a href="#" data-endpoint="/crest/chat/channels/">GET /crest/chat/channels/</a></li>
          <li><a href="#" data-endpoint="/crest/chat/channels/{id}/members/">GET /crest/chat/channels/{id}/members/</a></li>
          <li><a href="#" data-endpoint="/crest/chat/channels/{id}/messages/">GET /crest/chat/channels/{id}/messages/</a></li>
          <li><a href="#" data-endpoint="/crest/market/groups/">GET /crest/market/groups/</a></li>
          <li><a href="#" data-endpoint="/crest/market/types/">GET /crest/market/types/</a></li>
          <li><a href="#" data-endpoint="/crest/market/prices/">GET /crest/market/prices/</a></li>
          <li><a href="#" data-endpoint="/crest/market/orders/">GET /crest/market/orders/</a></li>
          <li><a href="#" data-endpoint="/crest/accounting/accounts/">GET /crest/accounting/accounts/</a></li>
          <li><a href="#" data-endpoint="/crest/accounting/accounts/{id}/transactions/">GET /crest/accounting/accounts/{id}/transactions/</a></li>
        </ul>
      </details>
    </div>

    <div>
      <div class="panel">
        <h3>Endpoint</h3>
        <form id="apiForm" onsubmit="return false;">
          <div><label><b>URL:</b> <span id="endpoint-label">Select an endpoint</span></label></div>
          <div id="input-fields"></div>
          <button class="btn" onclick="sendRequest()">Send</button>
        </form>
      </div>

      <div class="panel">
        <h3>Example Response</h3>
        <button class="refresh-btn" onclick="loadExamples()">↻ Refresh Examples</button>
        <pre id="example" class="code-block">Select an endpoint to see a sample response...</pre>
      </div>

      <div class="panel">
        <h3>Live Response</h3>
        <pre id="response" class="code-block"></pre>
      </div>
    </div>
  </div>
</main>

<script>
let examples = {};
let currentEndpoint = null;

async function loadExamples(){
  try {
    const res = await fetch("endpoints.json?ts=" + Date.now());
    examples = await res.json();
    if(currentEndpoint){
      document.getElementById('example').textContent = JSON.stringify(examples[currentEndpoint]||{}, null, 2);
    }
  } catch(err){
    console.error("Failed to load endpoints.json", err);
  }
}
document.addEventListener("DOMContentLoaded", loadExamples);

document.querySelectorAll('.navlist a').forEach(link=>{
  link.addEventListener('click',e=>{
    e.preventDefault();
    document.querySelectorAll('.navlist a').forEach(l=>l.classList.remove('active'));
    link.classList.add('active');
    currentEndpoint = link.dataset.endpoint;
    document.getElementById('endpoint-label').textContent = currentEndpoint;
    document.getElementById('example').textContent = JSON.stringify(examples[currentEndpoint]||{"info":"No example available"}, null, 2);
    renderInputs(currentEndpoint);
  });
});

function renderInputs(endpoint){
  const container = document.getElementById('input-fields');
  container.innerHTML = "";
  if(endpoint.includes("{id}")){
    const label = endpoint.includes("characters")?"Character ID":
                  endpoint.includes("corporations")?"Corporation ID":
                  endpoint.includes("contracts")?"Contract ID":"ID";
    container.innerHTML = `<label>${label}:</label><br><input id="idInput"><br>`;
  }
}

async function sendRequest(){
  if(!currentEndpoint) return;
  let url = currentEndpoint;
  if(url.includes("{id}")){
    const idVal = document.getElementById('idInput').value;
    if(!idVal){alert("Please enter an ID");return;}
    url = url.replace("{id}",idVal);
  }
  try{
    const res = await fetch(url);
    const text = await res.text();
    document.getElementById('response').textContent = text;
  }catch(err){
    document.getElementById('response').textContent = "Error: "+err;
  }
}
</script>
</body>
</html>
